queryShard;testName;inputMatchers;expectedIndexMatchers;expectedScanMatchers
;simple_existing_metric_name;{__name__="http_requests_total"};{__name__="http_requests_total"};{}
;simple_existing_label_name;{method="GET"};{method="GET"};{}
;simple_existing_label_name;{instance="web-us-east-1-a-001"};{instance="web-us-east-1-a-001"};{}
;simple_low_cardinality_label_name;{pod="test-runner-opqrstuvwx-11111"};{pod="test-runner-opqrstuvwx-11111"};{}
;specific_low_cardinality_label_high_cardinality_metric_name;{__name__="go_memstats_alloc_bytes",pod="test-runner-opqrstuvwx-11111"};{pod="test-runner-opqrstuvwx-11111"};{__name__="go_memstats_alloc_bytes"}
;high_cardinality_regex_prefix_matcher;{pod=~"prometheus-.*"};{pod=~"prometheus-.*"};{}
;high_cardinality_exact_matcher;{container="nginx"};{container="nginx"};{}
;high_cardinality_exact_matcher;{namespace="monitoring"};{namespace="monitoring"};{}
;non_existent_label;{non_existent_label="foo"};{non_existent_label="foo"};{}
;high_cardinality_exact_matchers;{__name__="http_requests_total",method="GET"};{__name__="http_requests_total",method="GET"};{}
;higher_cardinality_regex_prefix_and_exact_matcher;{__name__=~"http.*",method="POST"};{__name__=~"http.*",method="POST"};{}
;negative_exact_matcher;{job!="prometheus"};{job!="prometheus"};{}
;empty_matchers;{__name__="",method=""};{__name__=""};{method=""}
;exact_non_existent_metric_high_cardinality_method;{__name__="non_existent_metric",method="GET"};{__name__="non_existent_metric"};{method="GET"}
;high_cardinality_regex_set_matcher;{__name__=~"http_requests_total|cpu_usage_percent"};{__name__=~"http_requests_total|cpu_usage_percent"};{}
;high_cardinality_negative_metchers;{job!="prometheus",method!="GET"};{job!="prometheus",method!="GET"};{}
;metric_name_with_multiple_negative_matchers;{__name__="http_requests_total",job!="test",method!="DELETE"};{__name__="http_requests_total",job!="test",method!="DELETE"};{}
;metric_name_with_multiple_wildcard_regex_matchers;{__name__="http_requests_total",method=~".*",status=~".*",job=~".*"};{__name__="http_requests_total",method=~".*",status=~".*",job=~".*"};{}
;metric_name_with_multiple_exact_matchers;{__name__="http_requests_total",method="GET",status="200",job="prometheus"};{__name__="http_requests_total",method="GET",status="200",job="prometheus"};{}
;metric_name_with_mixed_matcher_types;{__name__="http_requests_total",job!="test",method=~"GET|POST",status!~"5.*"};{__name__="http_requests_total",job!="test",method=~"GET|POST",status!~"5.*"};{}
;low_cardinality_instance_with_high_cardinality_metric_and_method;{__name__="http_requests_total",instance="web-us-east-1-a-001",method="GET"};{instance="web-us-east-1-a-001"};{__name__="http_requests_total",method="GET"}
;low_cardinality_instance_with_high_cardinality_metric;{__name__="http_requests_total",instance="web-us-east-1-a-001"};{instance="web-us-east-1-a-001"};{__name__="http_requests_total"}
;high_cardinality_regex_with_exact_matcher;{pod=~"prometheus-.*",namespace="monitoring"};{pod=~"prometheus-.*",namespace="monitoring"};{}
;high_cardinality_metric_with_regex_matcher;{__name__="cpu_usage_percent",pod=~"grafana-.*"};{__name__="cpu_usage_percent",pod=~"grafana-.*"};{}
;multiple_high_cardinality_exact_matchers;{job="prometheus",container="prometheus"};{job="prometheus",container="prometheus"};{}
;mixed_cardinality_exact_matchers;{namespace="monitoring",method="GET",status="200"};{namespace="monitoring",method="GET",status="200"};{}
;low_cardinality_regex_with_exact_matcher;{instance=~"web-us-east-1-.*",method="POST"};{instance=~"web-us-east-1-.*",method="POST"};{}
;low_cardinality_instance_with_negative_empty_metric_name;{instance="web-us-east-1-a-001",__name__!=""};{instance="web-us-east-1-a-001"};{__name__!=""}
;low_cardinality_instance_with_specific_metric;{instance="web-us-east-1-a-001",__name__="prometheus_config_reload"};{instance="web-us-east-1-a-001"};{__name__="prometheus_config_reload"}
;high_cardinality_regex_pattern_with_exact_matcher;{pod=~".*-abcdefghij-.*",container="nginx"};{pod=~".*-abcdefghij-.*",container="nginx"};{}
;high_cardinality_metric_with_mixed_cardinality_labels;{__name__="memory_usage_bytes",namespace="kube-system",container="fluentd"};{__name__="memory_usage_bytes",namespace="kube-system",container="fluentd"};{}
;mixed_cardinality_with_regex_and_exact_matchers;{job="grafana",instance=~"api-.*",method="GET",status="404"};{job="grafana",instance=~"api-.*",status="404"};{method="GET"}
;high_cardinality_metric_with_regex_and_exact_matchers;{__name__="network_bytes_sent",namespace="default",pod=~"redis-.*",container="redis"};{__name__="network_bytes_sent",pod=~"redis-.*",container="redis"};{namespace="default"}
;low_cardinality_regex_with_high_cardinality_matchers;{instance=~"db-.*",container="postgres",method="POST",status=~"5.*"};{instance=~"db-.*",container="postgres",status=~"5.*"};{method="POST"}
;complex_high_cardinality_metric_with_multiple_matchers;{__name__="go_memstats_alloc_bytes",job="prometheus",namespace="monitoring",pod=~"prometheus-.*",instance=~"monitor-.*"};{__name__="go_memstats_alloc_bytes",pod=~"prometheus-.*",instance=~"monitor-.*"};{job="prometheus",namespace="monitoring"}
;conflicting_instance_matchers_exact_wins;{__name__="go_memstats_alloc_bytes",job="prometheus",namespace="monitoring",instance=~".*web.*|.*prometheus.*|.*not-prometheus.*|.*nginx.*|.*foo.*|.*bar.*|.*baz.*",instance="web-us-east-1-a-001"};{__name__="go_memstats_alloc_bytes",instance="web-us-east-1-a-001"};{job="prometheus",namespace="monitoring",instance=~".*web.*|.*prometheus.*|.*not-prometheus.*|.*nginx.*|.*foo.*|.*bar.*|.*baz.*"}
;non_existent_regex_in_a_regular_query;{__name__="go_memstats_alloc_bytes",job="prometheus",namespace="monitoring",pod=~"prometheus-.*",instance=~"monitor-.*",non_existent=~".*(go_memstats_alloc_bytes(_total)?).*"};{non_existent=~".*(go_memstats_alloc_bytes(_total)?).*"};{__name__="go_memstats_alloc_bytes",job="prometheus",namespace="monitoring",pod=~"prometheus-.*",instance=~"monitor-.*"}
;non_existent_negative_regexp_in_a_regular_query;{__name__="go_memstats_alloc_bytes",job="prometheus",namespace="monitoring",pod=~"prometheus-.*",instance=~"monitor-.*",non_existent!~".*(go_memstats_alloc_bytes(_total)?).*"};{__name__="go_memstats_alloc_bytes",pod=~"prometheus-.*",instance=~"monitor-.*"};{job="prometheus",namespace="monitoring",non_existent!~".*(go_memstats_alloc_bytes(_total)?).*"}
;non_existent_in_a_regular_query;{__name__="go_memstats_alloc_bytes",job="prometheus",namespace="monitoring",pod=~"prometheus-.*",instance=~"monitor-.*",non_existent="go_memstats_alloc_bytes_total"};{non_existent="go_memstats_alloc_bytes_total"};{__name__="go_memstats_alloc_bytes",job="prometheus",namespace="monitoring",pod=~"prometheus-.*",instance=~"monitor-.*"}
;non_existent_negative_in_a_regular_query;{__name__="go_memstats_alloc_bytes",job="prometheus",namespace="monitoring",pod=~"prometheus-.*",instance=~"monitor-.*",non_existent!="go_memstats_alloc_bytes_total"};{__name__="go_memstats_alloc_bytes",pod=~"prometheus-.*",instance=~"monitor-.*"};{job="prometheus",namespace="monitoring",non_existent!="go_memstats_alloc_bytes_total"}
;non_existent_value_regex_in_a_regular_query;{__name__="go_memstats_alloc_bytes",job="prometheus",namespace="monitoring",pod=~"prometheus-.*",instance=~"monitor-.*",status=~"TEST123?.*"};{__name__="go_memstats_alloc_bytes",job="prometheus",pod=~"prometheus-.*",status=~"TEST123?.*"};{namespace="monitoring",instance=~"monitor-.*"}
;non_existent_set_value_regex_in_a_regular_query;{__name__="go_memstats_alloc_bytes",job="prometheus",namespace="monitoring",pod=~"prometheus-.*",instance=~"monitor-.*",status=~"(TEST|TEST123)"};{status=~"(TEST|TEST123)"};{__name__="go_memstats_alloc_bytes",job="prometheus",namespace="monitoring",pod=~"prometheus-.*",instance=~"monitor-.*"}
;non_existent_value_negative_regexp_in_a_regular_query;{__name__="go_memstats_alloc_bytes",job="prometheus",namespace="monitoring",pod=~"prometheus-.*",instance=~"monitor-.*",status!~"TEST123?.*"};{__name__="go_memstats_alloc_bytes",pod=~"prometheus-.*",instance=~"monitor-.*"};{job="prometheus",namespace="monitoring",status!~"TEST123?.*"}
;non_existent_value_in_a_regular_query;{__name__="go_memstats_alloc_bytes",job="prometheus",namespace="monitoring",pod=~"prometheus-.*",instance=~"monitor-.*",status="TEST123"};{status="TEST123"};{__name__="go_memstats_alloc_bytes",job="prometheus",namespace="monitoring",pod=~"prometheus-.*",instance=~"monitor-.*"}
;non_existent_value_negative_in_a_regular_query;{__name__="go_memstats_alloc_bytes",job="prometheus",namespace="monitoring",pod=~"prometheus-.*",instance=~"monitor-.*",status!="TEST123"};{__name__="go_memstats_alloc_bytes",pod=~"prometheus-.*",instance=~"monitor-.*"};{job="prometheus",namespace="monitoring",status!="TEST123"}
;multiple_instance_matchers_one_with_low_cardinality_another_with_empty_matcher;{__name__="go_memstats_alloc_bytes",job="prometheus",namespace="monitoring",instance=~".+",instance="web-us-east-1-a-001"};{instance="web-us-east-1-a-001"};{__name__="go_memstats_alloc_bytes",job="prometheus",namespace="monitoring",instance=~".+"}
;multiple_instance_matchers_one_with_low_cardinality_another_matching_a_lot_of_values;{job="prometheus",namespace="monitoring",instance=~".*web.*|.*prometheus.*|.*not-prometheus.*|.*nginx.*|.*foo.*|.*bar.*|.*baz.*",instance="web-us-east-1-a-001"};{instance="web-us-east-1-a-001"};{job="prometheus",namespace="monitoring",instance=~".*web.*|.*prometheus.*|.*not-prometheus.*|.*nginx.*|.*foo.*|.*bar.*|.*baz.*"}
;expensive_alternating_regex_with_dot_stars;{job="prometheus",namespace="monitoring",instance=~".*web.*|.*prometheus.*|.*not-prometheus.*|.*nginx.*|.*foo.*|.*bar.*|.*baz.*"};{job="prometheus",namespace="monitoring",instance=~".*web.*|.*prometheus.*|.*not-prometheus.*|.*nginx.*|.*foo.*|.*bar.*|.*baz.*"};{}
;expensive_alternating_regex_with_dot_stars_and_a_negative_matcher;{job="prometheus",namespace!="monitoring",instance=~".*web.*|.*prometheus.*|.*not-prometheus.*|.*nginx.*|.*foo.*|.*bar.*|.*baz.*"};{job="prometheus",namespace!="monitoring",instance=~".*web.*|.*prometheus.*|.*not-prometheus.*|.*nginx.*|.*foo.*|.*bar.*|.*baz.*"};{}
;twenty_matchers_all_exact_high_cardinality;{__name__="http_requests_total",method="GET",status="200",job="prometheus",container="nginx",namespace="monitoring",pod="prometheus-abcdefghij-12345",instance="web-us-east-1-a-001",handler="GET",code="GET",team="GET",service="GET",version="GET",cluster="GET",datacenter="GET",host="GET",app="GET",route="GET",user="GET",client="GET"};{pod="prometheus-abcdefghij-12345"};{__name__="http_requests_total",method="GET",status="200",job="prometheus",container="nginx",namespace="monitoring",instance="web-us-east-1-a-001",handler="GET",code="GET",team="GET",service="GET",version="GET",cluster="GET",datacenter="GET",host="GET",app="GET",route="GET",user="GET",client="GET"}
;twenty_matchers_mixed_types_with_low_cardinality;{__name__="cpu_usage_percent",method="GET",status=~"2..",job!="test-runner",container="nginx",namespace="monitoring",pod=~"prometheus-.*",instance="web-us-east-1-a-001",handler="POST",code=~".*GET.*",team!="DELETE",service=~"prom.*",version!~".*test.*",cluster="200",datacenter=~".*monitoring.*",host!="500",app="grafana",route!~".*backup.*",user="nginx",client=~".*web.*"};{instance="web-us-east-1-a-001",code=~".*GET.*",service=~"prom.*",datacenter=~".*monitoring.*",client=~".*web.*"};{__name__="cpu_usage_percent",method="GET",status=~"2..",job!="test-runner",container="nginx",namespace="monitoring",pod=~"prometheus-.*",handler="POST",team!="DELETE",version!~".*test.*",cluster="200",host!="500",app="grafana",route!~".*backup.*",user="nginx"}
;twenty_matchers_all_regex_patterns;{__name__=~"http.*",method=~"GET|POST",status=~"2..",job=~"prometheus|grafana",container=~"prometheus|nginx",namespace=~"monitoring|default",pod=~"prometheus-.*",instance=~"web-.*|api-.*",handler=~".*GET.*",code=~"2..",team=~"prometheus|grafana",service=~"nginx|redis",version=~"monitoring|default",cluster=~"prometheus-.*",datacenter=~"web-.*|api-.*",host=~"GET|POST",app=~"2..",route=~"prometheus.*",user=~"nginx.*",client=~"monitoring.*"};{handler=~".*GET.*",code=~"2..",cluster=~"prometheus-.*",datacenter=~"web-.*|api-.*",user=~"nginx.*",client=~"monitoring.*"};{__name__=~"http.*",method=~"GET|POST",status=~"2..",job=~"prometheus|grafana",container=~"prometheus|nginx",namespace=~"monitoring|default",pod=~"prometheus-.*",instance=~"web-.*|api-.*",team=~"prometheus|grafana",service=~"nginx|redis",version=~"monitoring|default",host=~"GET|POST",app=~"2..",route=~"prometheus.*"}
;twenty_matchers_all_negative_exact;{__name__!="test_metric_small",method!="DELETE",status!="500",job!="test-runner",container!="init-container",namespace!="backup",pod!="backup-controller-abcdefghij-12345",instance!="cache-us-east-1-a-001",handler!="OPTIONS",code!="429",team!="DELETE",service!="PATCH",version!="503",cluster!="admin",datacenter!="log-shipper",host!="health-check",app!="config-reloader",route!="security",user!="staging",client!="development"};{__name__!="test_metric_small",method!="DELETE",status!="500",job!="test-runner",container!="init-container",namespace!="backup",pod!="backup-controller-abcdefghij-12345",instance!="cache-us-east-1-a-001",handler!="OPTIONS",code!="429",team!="DELETE",service!="PATCH",version!="503",cluster!="admin",datacenter!="log-shipper",host!="health-check",app!="config-reloader",route!="security",user!="staging",client!="development"};{}
;twenty_matchers_all_exact;{__name__="test_metric_small",method="DELETE",status="500",job="test-runner",container="init-container",namespace="backup",pod="backup-controller-abcdefghij-12345",instance="cache-us-east-1-a-001",handler="OPTIONS",code="429",team="DELETE",service="PATCH",version="503",cluster="admin",datacenter="log-shipper",host="health-check",app="config-reloader",route="security",user="staging",client="development"};{__name__="test_metric_small",client="development"};{method="DELETE",status="500",job="test-runner",container="init-container",namespace="backup",pod="backup-controller-abcdefghij-12345",instance="cache-us-east-1-a-001",handler="OPTIONS",code="429",team="DELETE",service="PATCH",version="503",cluster="admin",datacenter="log-shipper",host="health-check",app="config-reloader",route="security",user="staging"}
;twenty_matchers_all_negative_regex;{__name__!~"test_.*|debug_.*",method!~"DELETE|PUT",status!~"5..",job!~"test-.*|backup-.*",container!~"init-.*|health-.*",namespace!~"backup|security",pod!~"test-.*|backup-.*",instance!~"cache-.*",handler!~".*test.*",code!~".*debug.*",team!~"foo.*",service!~"bar.*",version!~"baz.*",cluster!~"xyz.*",datacenter!~"abc.*",host!~"dev.*",app!~"tmp.*",route!~"old.*",user!~"deprecated.*",client!~"removed.*"};{__name__!~"test_.*|debug_.*",status!~"5..",job!~"test-.*|backup-.*",container!~"init-.*|health-.*",pod!~"test-.*|backup-.*"};{method!~"DELETE|PUT",namespace!~"backup|security",instance!~"cache-.*",handler!~".*test.*",code!~".*debug.*",team!~"foo.*",service!~"bar.*",version!~"baz.*",cluster!~"xyz.*",datacenter!~"abc.*",host!~"dev.*",app!~"tmp.*",route!~"old.*",user!~"deprecated.*",client!~"removed.*"}
;twenty_matchers_with_non_existent_labels;{__name__="go_memstats_alloc_bytes",method="GET",status="200",job="prometheus",nonexist1="value1",container="nginx",nonexist2="value2",namespace="monitoring",nonexist3=~".*",pod="prometheus-abcdefghij-12345",nonexist4!="value4",instance="web-us-east-1-a-001",nonexist5!~".*test.*",nonexist6="value6",nonexist7=~"pattern.*",nonexist8!="value8",nonexist9="value9",nonexist10=~".*val.*",nonexist11!="value11",nonexist12!~"test.*"};{nonexist1="value1",nonexist7=~"pattern.*",nonexist10=~".*val.*"};{__name__="go_memstats_alloc_bytes",method="GET",status="200",job="prometheus",container="nginx",nonexist2="value2",namespace="monitoring",nonexist3=~".*",pod="prometheus-abcdefghij-12345",nonexist4!="value4",instance="web-us-east-1-a-001",nonexist5!~".*test.*",nonexist6="value6",nonexist8!="value8",nonexist9="value9",nonexist11!="value11",nonexist12!~"test.*"}
;twenty_matchers_half_existent_half_nonexistent_exact;{__name__="go_memstats_alloc_bytes",nonexist1="value1",method="GET",nonexist2="value2",status="200",nonexist3="value3",job="prometheus",nonexist4="value4",container="nginx",nonexist5="value5",namespace="monitoring",nonexist6="value6",pod="prometheus-abcdefghij-12345",nonexist7="value7",instance="web-us-east-1-a-001",nonexist8="value8",nonexist9="value9",nonexist10="value10",nonexist11="value11",nonexist12="value12"};{nonexist1="value1"};{__name__="go_memstats_alloc_bytes",method="GET",nonexist2="value2",status="200",nonexist3="value3",job="prometheus",nonexist4="value4",container="nginx",nonexist5="value5",namespace="monitoring",nonexist6="value6",pod="prometheus-abcdefghij-12345",nonexist7="value7",instance="web-us-east-1-a-001",nonexist8="value8",nonexist9="value9",nonexist10="value10",nonexist11="value11",nonexist12="value12"}
;twenty_matchers_expensive_regex_patterns;{__name__=~".*http.*|.*cpu.*|.*mem.*",method=~".*GET.*|.*POST.*",status=~".*2.*|.*3.*|.*4.*",job=~".*prom.*|.*grafana.*",container=~".*nginx.*|.*redis.*",namespace=~".*monitoring.*|.*kube.*",pod=~".*prometheus.*|.*grafana.*",instance=~".*web.*|.*api.*|.*db.*",handler=~".*GET.*",code=~".*[0-9].*",team=~".*prom.*|.*grafana.*",service=~".*nginx.*",version=~".*/api/.*|.*/v1/.*",cluster=~".*monitoring.*",datacenter=~".*cluster-[0-9].*",host=~".*dc[0-9].*",app=~".*host-.*",route=~".*app.*|.*svc.*",user=~".*v[0-9]+.*",client=~".*region-.*"};{handler=~".*GET.*",code=~".*[0-9].*",team=~".*prom.*|.*grafana.*",version=~".*/api/.*|.*/v1/.*",client=~".*region-.*"};{__name__=~".*http.*|.*cpu.*|.*mem.*",method=~".*GET.*|.*POST.*",status=~".*2.*|.*3.*|.*4.*",job=~".*prom.*|.*grafana.*",container=~".*nginx.*|.*redis.*",namespace=~".*monitoring.*|.*kube.*",pod=~".*prometheus.*|.*grafana.*",instance=~".*web.*|.*api.*|.*db.*",service=~".*nginx.*",cluster=~".*monitoring.*",datacenter=~".*cluster-[0-9].*",host=~".*dc[0-9].*",app=~".*host-.*",route=~".*app.*|.*svc.*",user=~".*v[0-9]+.*"}
;twenty_matchers_with_empty_values;{__name__="",method="",status="",job="",container="",namespace="",pod="",instance="",handler="",code="",team="",service="",version="",cluster="",datacenter="",host="",app="",route="",user="",client=""};{__name__="",status="",job="",container="",pod=""};{method="",namespace="",instance="",handler="",code="",team="",service="",version="",cluster="",datacenter="",host="",app="",route="",user="",client=""}
;twenty_matchers_with_mostly_empty_values;{__name__="go_memstats_alloc_bytes",method="",status="",job="",container="",namespace="",pod="",instance="",handler="",code="",team="",service="",version="",cluster="",datacenter="",host="",app="",route="",user="",client=""};{__name__="go_memstats_alloc_bytes",status="",job="",container="",pod=""};{method="",namespace="",instance="",handler="",code="",team="",service="",version="",cluster="",datacenter="",host="",app="",route="",user="",client=""}
;twenty_matchers_duplicate_label_low_cardinality_wins;{__name__="go_memstats_alloc_bytes",method="GET",status="200",job="prometheus",container="nginx",namespace="monitoring",pod="prometheus-abcdefghij-12345",instance=~".*web.*|.*api.*|.*db.*",instance="web-us-east-1-a-001",handler="POST",code="404",team="PUT",service="grafana",version="alertmanager",cluster="default",datacenter="fluentd",host="postgres",app="kibana",route="jaeger-agent",user="log-shipper",client="redis"};{pod="prometheus-abcdefghij-12345"};{__name__="go_memstats_alloc_bytes",method="GET",status="200",job="prometheus",container="nginx",namespace="monitoring",instance=~".*web.*|.*api.*|.*db.*",instance="web-us-east-1-a-001",handler="POST",code="404",team="PUT",service="grafana",version="alertmanager",cluster="default",datacenter="fluentd",host="postgres",app="kibana",route="jaeger-agent",user="log-shipper",client="redis"}
1_of_16;simple_existing_metric_name_with_sharding;{__name__="http_requests_total"};{__name__="http_requests_total"};{}
1_of_16;high_cardinality_exact_matcher_with_sharding;{container="nginx"};{container="nginx"};{}
1_of_16;metric_name_with_multiple_exact_matchers_with_sharding;{__name__="http_requests_total",method="GET",status="200",job="prometheus"};{__name__="http_requests_total",method="GET",status="200",job="prometheus"};{}
1_of_16;low_cardinality_instance_with_high_cardinality_metric_and_method_with_sharding;{__name__="http_requests_total",instance="web-us-east-1-a-001",method="GET"};{instance="web-us-east-1-a-001"};{__name__="http_requests_total",method="GET"}
1_of_16;complex_high_cardinality_metric_with_multiple_matchers_with_sharding;{__name__="go_memstats_alloc_bytes",job="prometheus",namespace="monitoring",pod=~"prometheus-.*",instance=~"monitor-.*"};{__name__="go_memstats_alloc_bytes",pod=~"prometheus-.*",instance=~"monitor-.*"};{job="prometheus",namespace="monitoring"}
1_of_16;edge_case_low_cardinality_with_high_shard_count;{__name__="startup_duration"};{__name__="startup_duration"};{}
