# SPDX-License-Identifier: AGPL-3.0-only

load 5m
  abc_metric{instance="a", job="1", label="value"} 0 1 2
  abc_info{instance="a", job="1", data="info", another_data="another info"} 1 1 1

# Multiple positive __name__ matchers.
eval range from 0m to 10m step 5m info(abc_metric, {__name__=~".*abc.*", __name__=~".*info.*"})
  abc_metric{instance="a", job="1", label="value", data="info", another_data="another info"} 0 1 2

clear

load 1m
  test_metric{instance="a", job="1", env="prod"} 1 2 3
  test_metric{instance="b", job="2", env="dev"} 4 5 6
  target_info{instance="a", job="1", category="web", priority="high"} 1 1 1
  target_info{instance="b", job="2", category="api", priority="low"} 1 1 1
  target_info{instance="a", job="1", category="database", priority="medium"} 1 1 1
  target_info{instance="b", job="2", category="cache", priority="high"} 1 1 1

# Multiple data matchers with the same label name but different values - no intersection, should return no results
eval range from 0m to 2m step 1m info(test_metric, {category="web", category="api"})

# Multiple positive data matchers with the same label name - should match intersection
eval range from 0m to 2m step 1m info(test_metric, {priority=~"high|medium", priority=~"high|low"})
  test_metric{instance="a", job="1", env="prod", priority="high"} 1 2 3
  test_metric{instance="b", job="2", env="dev", priority="high"} 4 5 6

# Mixed positive and negative data matchers with the same label name - should match intersection
eval range from 0m to 2m step 1m info(test_metric, {priority=~"high|medium", priority!="high"})
  test_metric{instance="a", job="1", env="prod", priority="medium"} 1 2 3

# Multiple __name__ matchers combined with other data matchers
eval range from 0m to 2m step 1m info(test_metric, {__name__=~".*info", __name__=~"target.*", category=~"web|api"})
  test_metric{instance="a", job="1", env="prod", category="web"} 1 2 3
  test_metric{instance="b", job="2", env="dev", category="api"} 4 5 6
