---
title: "Compaction planner tool"
description: ""
weight: 100
---

# Compaction planner tool

The compaction planner tool is for troubleshooting the Grafana Mimir compactor. It loads a bucket index from
the object storage (f.ex. Google Cloud Storage) and shows compaction jobs that would be generated by the
split-and-merge compaction strategy. Unlike the compactor itself, which scans the bucket for blocks, the tool
informs itself from the bucket index. This means that the jobs listed by the compaction planner tool may
not reflect the current state of the bucket. The compactor updates the bucket index every
`-compactor.cleanup-interval`.

The compaction planner tool needs to be configured with at least the following parameters:

- The tenant ID (the `-user` flag)
- What storage backend to use (the `-backend` flag)
- Those required by the chosen storage backend (f.ex. the `gcs` backend will require the `-gcs.bucket-name` flag)

Additionally, you might need to tweak shard count (`-shard-count` flag) and split groups (`-split-groups` flag)
to match the corresponding split-and-merge compactor parameters. The compaction planner tool is not able to
automatically deduce them itself. The ordering of the jobs can be modified through the `-sorting` flag.

Example:

```
$ ./compaction-planner -backend=gcs -gcs.bucket-name=blocks-bucket -user=10428 -split-groups=1 -shard-count=4
2022-02-04 09:52:05.506428 I | Using index from 2022-02-04T08:38:27Z
2022-02-04 09:52:05.533720 I | Filtering using *compactor.NoCompactionMarkFilter
Job No.   Start Time             End Time               Blocks   Job Key
1         2022-02-04T02:00:00Z   2022-02-04T04:00:00Z   4        0@6672437747845546250-merge-2_of_4-1643940000000-1643947200000
2         2022-02-04T02:00:00Z   2022-02-04T04:00:00Z   4        0@6672437747845546250-merge-4_of_4-1643940000000-1643947200000
3         2022-02-04T04:00:00Z   2022-02-04T06:00:00Z   4        0@6672437747845546250-merge-1_of_4-1643947200000-1643954400000
4         2022-02-04T04:00:00Z   2022-02-04T06:00:00Z   4        0@6672437747845546250-merge-2_of_4-1643947200000-1643954400000
5         2022-02-04T04:00:00Z   2022-02-04T06:00:00Z   4        0@6672437747845546250-merge-3_of_4-1643947200000-1643954400000
6         2022-02-04T04:00:00Z   2022-02-04T06:00:00Z   4        0@6672437747845546250-merge-4_of_4-1643947200000-1643954400000
```

The output lists compaction jobs that the Grafana Mimir compactor would work on, provided it's configured
equivalently to the compaction planner tool. The compactor would work on the jobs in the same order as listed.
