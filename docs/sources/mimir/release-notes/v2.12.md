---
title: "Grafana Mimir version 2.12 release notes"
menuTitle: "V2.12 release notes"
description: "Release notes for Grafana Mimir version 2.12"
weight: 1000
---

# Grafana Mimir version 2.12 release notes

Grafana Labs is excited to announce version 2.12 of Grafana Mimir.

The highlights that follow include the top features, enhancements, and bugfixes in this release. For the complete list of changes, see the [changelog](https://github.com/grafana/mimir/blob/main/CHANGELOG.md).

## Features and enhancements

- **Added mimir-distroless docker image, built upon the distroless. This improvement is geared towards minimising attack surfaces and mitigating potential CVEs by trimming down the dependencies within the image. After comprehensive testing, we plan to shift from the default docker image to distroless.
- **Added support to only count series that are considered _active_** through the Cardinality API endpoint `/api/v1/cardinality/label_names` by passing the `count_method` parameter. If set to `active` it counts only series that are considered _active_ according to the `-ingester.active-series-metrics-idle-timeout` flag setting rather than counting all in-memory series.
- **The total number of OTLP requests** is tracked by the new `cortex_distributor_otlp_requests_total` metric.
- **The total number of queries executed for a particular source (ingester vs. store-gateway)** is tracked by the new `cortex_querier_queries_storage_type_total` metric.
- **The total number of chunks fetched from a store gateway** is tracked by the new `cortex_querier_query_storegateway_chunks_total` metric.
- **The "Store-gateway: bucket tenant blocks" admin page contains a new column "No Compact"**. If block no compaction marker is set, it specifies the reason and the date the marker is added.
- **The estimated number of compaction jobs based on the current bucket-index** is now computed by the compactor. The result is tracked by the new `cortex_bucket_index_compaction_jobs` metric. If this computation fails, the `cortex_bucket_index_compaction_jobs_errors_total` metric is updated instead.

Additionally, the following previously experimental features are now considered stable:

- **The number of pre-allocated workers used to forward push requests to the ingesters**, configurable via the `-distributor.reusable-ingester-push-workers` CLI flag on distributors. It now defaults to 2000. Note that this is a performance optimization, and not a limiting feature. If not enough workers available, a new goroutine will be spawned.
- **The number of gRPC server workers used to serve the requests**, configurable via the `-server.grpc.num-workers` CLI flag. It now defaults to 100. Note that this is the number of pre-allocated long-lived workers, and not a limiting feature. When all workers are busy, a new goroutine will be spawned.
- **The maximum number of concurrent index header loads across all tenants**, configurable via the `-blocks-storage.bucket-store.index-header.lazy-loading-concurrency` CLI flag on store-gateways.
- **The maximum time to wait for the query-frontend to become ready before rejecting requests**, configurable via the `-query-frontend.not-running-timeout` CLI flags on query-frontends. It now defaults to 2s.
- **Spread-minimizing token-related CLI flags**: `-ingester.ring.token-generation-strategy`, `-ingester.ring.spread-minimizing-zones` and `-ingester.ring.spread-minimizing-join-ring-in-order`.

## Experimental features

Grafana Mimir 2.12 includes new features that are considered experimental and disabled by default. Please use them with caution and report any issue you encounter:

- **The maximum number of tenant IDs that may be for a federated query** can be configured via the `-tenant-federation.max-tenants` CLI flag on query-frontends. By default, it is 0, meaning that the limit is disabled.
- **Sharding of active series queries can be enabled** via the `-query-frontend.shard-active-series-queries` CLI flag on query-frontends.
- **Timely head compaction** can be enabled via the `-blocks-storage.tsdb.timely-head-compaction-enabled` on ingesters. If enabled, the head compaction happens when the min block range can no longer be appended, without requiring 1.5x the chunk range worth of data in the head.
- **Streaming of responses from querier to query-frontend** can be enabled via the `-querier.response-streaming-enabled` CLI flag on queriers. This is currently supported only for responses from the `/api/v1/cardinality/active_series` endpoint.
- **The maximum response size for active series queries** (in bytes) can be set via the `-querier.active-series-results-max-size-bytes` CLI flag on queriers.
- **Metric relabeling on a per-tenant basis can be forcefully disabled** via the `-distributor.metric-relabeling-enabled` CLI flag on rulers. Metrics relabeling is enabled by default.

### Helm chart improvements

The Grafana Mimir and Grafana Enterprise Metrics Helm chart is now released independently. See the [Grafana Mimir Helm chart documentation](/docs/helm-charts/mimir-distributed/latest/).

## Important changes

In Grafana Mimir 2.12 the following behavior has changed:

- Store-gateway now persists a sparse version of the index-header to disk on construction and loads sparse index-headers from disk instead of the whole index-header.
- Alertmanager deprecated the `v1` API. All `v1` API endpoints now respond with a JSON deprecation notice and a status code of `410`. All endpoints have a `v2` equivalent. The list of endpoints is:
  - `<alertmanager-web.external-url>/api/v1/alerts`
  - `<alertmanager-web.external-url>/api/v1/receivers`
  - `<alertmanager-web.external-url>/api/v1/silence/{id}`
  - `<alertmanager-web.external-url>/api/v1/silences`
  - `<alertmanager-web.external-url>/api/v1/status`
- Exemplar's label `traceID` has been changed to `trace_id`, in order to be consistent with the OpenTelemetry standard.
- Errors returned by ingesters now contain only gRPC status codes. Previously they contained both gRPC and HTTP status codes. Note: in order to guarantee backwards compatibility when migrating from a version prior to `2.11`, it is necessary to first migrate to version `2.11`, and then to version `2.12`.
- Responses with gRPC status codes are now reported as `status_code` labels in the `cortex_request_duration_seconds` and `cortex_ingester_client_request_duration_seconds` metrics.
- Responses with HTTP 4xx status codes are now treated as errors and used in `status_code` label of request duration metric.

The default value of the following CLI flags has been changed:

- `-blocks-storage.tsdb.head-postings-for-matchers-cache-max-bytes` from `10MB` to `100MB`.
- `-blocks-storage.tsdb.block-postings-for-matchers-cache-max-bytes` from `10MB` to `100MB`.
- `-blocks-storage.bucket-store.tenant-sync-concurrency` from `10` to `1`.
- `-query-frontend.max-cache-freshness` from `1m` to `10m`.
- `-distributor.write-requests-buffer-pooling-enabled` from `false` to `true`.
- `-locks-storage.bucket-store.block-sync-concurrency` from `20` to `4`.
- `-memberlist.stream-timeout` from `10s` to `2s`.
- `-server.report-grpc-codes-in-instrumentation-label-enabled` from `false` to `true`.

The following configuration options had been previously deprecated and are removed in Grafana Mimir 2.12:

- The deprecated YAML setting `frontend.cache_unaligned_requests`

The following configuration options are deprecated and will be removed in Grafana Mimir 2.14:

- The CLI flag `-ingester.limit-inflight-requests-using-grpc-method-limiter`. It now defaults to `true`.
- The CLI falg `-ingester.return-only-grpc-errors`. It now defaults to `true`. Note: in order to guarantee backwards compatibility when migrating from a version prior to `2.11`, it is necessary to first migrate to version `2.11`, and then to version `2.12`.
- The CLI flag `-ingester.client.report-grpc-codes-in-instrumentation-label-enabled`. It now defaults to `true`.
- The CLI flag `-distributor.limit-inflight-requests-using-grpc-method-limiter`. It now defaults to `true`.
- The CLI flag `-distributor.enable-otlp-metadata-storage`. It now defaults to `true`.
- The CLI flag `-querier.max-query-into-future`.
-

The following metrics are removed, deprecated or renamed:

- `cortex_bucket_store_blocks_loaded_by_duration` has been removed.
- `cortex_distributor_sample_delay_seconds` has been deprecated and will be removed in Mimir 2.14.
- `prometheus_sd_failed_configs` has been renamed to `cortex_prometheus_sd_failed_configs`
- `prometheus_sd_discovered_targets` has been renamed to `cortex_prometheus_sd_discovered_targets`
- `prometheus_sd_received_updates_total` has been renamed to `cortex_prometheus_sd_received_updates_total`
- `prometheus_sd_updates_delayed_total` has been renamed to `cortex_prometheus_sd_updates_delayed_total`
- `prometheus_sd_updates_total` has been renamed to `cortex_prometheus_sd_updates_total`
- `prometheus_sd_refresh_failures_total` has been renamed to `cortex_prometheus_sd_refresh_failures_total`
- `prometheus_sd_refresh_duration_seconds` has been renamed to `cortex_prometheus_sd_refresh_duration_seconds`

## Bug fixes

- Distributor: fixed an issue where `-distributor.metric-relabeling-enabled` could cause distributors to panic.
- Distributor: fix an issue where `-distributor.metric-relabeling-enabled` could cause distributors to write unsorted labels and corrupt blocks.
- Ingester: errors encountered while iterating through chunks or samples in response to a query request are not ignored anymore.
- Compactor: out-of-order blocks are not allowed to prevent timely compaction anymore.
- Querier: requests to store-gateway when a query gets canceled are not retried anymore.
- Querier: status code 499 is now returned instead of 500 when a request to remote read endpoint gets canceled.
- Querier: fixed an issue where `-querier.max-fetched-series-per-query` was not applied to `/series` endpoint in case series loaded from ingesters.
- Query-frontend: the `cortex_query_frontend_queries_total` metric incorrectly reported `op="query"` for any request which wasn't a range query. Now the `op` label value can be one of the following:
  - `query`: instant query
  - `query_range`: range query
  - `cardinality`: cardinality query
  - `label_names_and_values`: label names / values query
  - `active_series`: active series query
  - `other`: any other request
- Ruler: fixed an issue where "failed to remotely evaluate query expression, will retry" messages were logged without context such as the trace ID and did not appear in trace events.
- Ruler: requests to remote querier when server's response exceeds its configured max payload size are not retried anymore.
- Ruler: fixed a regression that caused client errors to be tracked in `cortex_ruler_write_requests_failed_total` metric.
- Ruler: fixed an issue with recording rule result being corruption due to an usage of a bad native histogram pointer.
