---
title: "Compaction planner"
description: ""
weight: 100
---

# Compaction planner

Compaction planner is a tool for troubleshooting compactor. It loads a bucket index and shows compaction jobs that would
be generated by the Mimir split-and-merge compactor. Because compaction planner uses bucket index to get a list of blocks
for a tenant, it doesn't have up-to-date view on the blocks in the bucket. (Bucket index is refreshed by running
compactor regularly, for example every 15 minutes.)

Compaction planner needs to be configured with access to the bucket, and tenant (`-user`) to work with. Furthermore
`-shard-count` and `-split-groups` options can be used to fine-tune the split-and-merge compactor parameters. Compaction
planner is not able to figure out these values from Mimir or existing configuration file. Ordering of the jobs can be
modified by `-sorting` option.

Example:

```
$ ./compaction-planner -backend=gcs -gcs.bucket-name=blocks-bucket -user=10428 -split-groups=1 -shard-count=4
2022-02-04 09:52:05.506428 I | Using index from 2022-02-04T08:38:27Z
2022-02-04 09:52:05.533720 I | Filtering using *compactor.NoCompactionMarkFilter
Job No.   Start Time             End Time               Blocks   Job Key
1         2022-02-04T02:00:00Z   2022-02-04T04:00:00Z   4        0@6672437747845546250-merge-2_of_4-1643940000000-1643947200000
2         2022-02-04T02:00:00Z   2022-02-04T04:00:00Z   4        0@6672437747845546250-merge-4_of_4-1643940000000-1643947200000
3         2022-02-04T04:00:00Z   2022-02-04T06:00:00Z   4        0@6672437747845546250-merge-1_of_4-1643947200000-1643954400000
4         2022-02-04T04:00:00Z   2022-02-04T06:00:00Z   4        0@6672437747845546250-merge-2_of_4-1643947200000-1643954400000
5         2022-02-04T04:00:00Z   2022-02-04T06:00:00Z   4        0@6672437747845546250-merge-3_of_4-1643947200000-1643954400000
6         2022-02-04T04:00:00Z   2022-02-04T06:00:00Z   4        0@6672437747845546250-merge-4_of_4-1643947200000-1643954400000
```

Each output line is one compaction job that Mimir's compactor with same parameters would work on in specified order.
