---
# Source: mimir-distributed/templates/distributor/autoscaling.yaml
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: keda-autoscaling-metamonitoring-values-mimir-distributor
  labels:
    app.kubernetes.io/name: mimir
    app.kubernetes.io/instance: keda-autoscaling-metamonitoring-values
    app.kubernetes.io/component: distributor
    app.kubernetes.io/part-of: memberlist
    app.kubernetes.io/managed-by: Helm
  annotations:
    {}
  namespace: "citestns"
spec:
  advanced:
    horizontalPodAutoscalerConfig:
      behavior:
        scaleDown:
          policies:
          - periodSeconds: 60
            type: Percent
            value: 10
  maxReplicaCount: 10
  minReplicaCount: 1
  pollingInterval: 10
  scaleTargetRef:
    name: keda-autoscaling-metamonitoring-values-mimir-distributor
    apiVersion: apps/v1
    kind: Deployment
  triggers:
  - metadata:
      metricName: cortex_distributor_cpu_hpa_default
      query: max_over_time(sum(rate(container_cpu_usage_seconds_total{container="distributor",namespace="citestns"}[5m]))[15m:]) * 1000
      serverAddress: https://mimir.example.com/prometheus
      threshold: "80"
      customHeaders: "X-Scope-OrgID=tenant-1"
    type: prometheus
  - metadata:
      metricName: cortex_distributor_memory_hpa_default
      query: max_over_time(sum(container_memory_working_set_bytes{container="distributor",namespace="citestns"})[15m:])
      serverAddress: https://mimir.example.com/prometheus
      threshold: "429496729"
      customHeaders: "X-Scope-OrgID=tenant-1"
    type: prometheus
