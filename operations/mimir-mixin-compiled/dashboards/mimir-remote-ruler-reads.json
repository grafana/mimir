{
      "__requires": [
         {
            "id": "grafana",
            "name": "Grafana",
            "type": "grafana",
            "version": "8.0.0"
         }
      ],
      "annotations": {
         "list": [ ]
      },
      "editable": true,
      "gnetId": null,
      "graphTooltip": 1,
      "hideControls": false,
      "links": [
         {
            "asDropdown": true,
            "icon": "external link",
            "includeVars": true,
            "keepTime": true,
            "tags": [
               "mimir"
            ],
            "targetBlank": false,
            "title": "Mimir dashboards",
            "type": "dashboards"
         }
      ],
      "refresh": "5m",
      "rows": [
         {
            "collapse": false,
            "height": "175px",
            "panels": [
               {
                  "content": "<p>\n  This dashboard shows health metrics for the ruler read path when remote operational mode is enabled.\n  It is broken into sections for each service on the ruler read path, and organized by the order in which the read request flows.\n  <br/>\n  For each service, there are three panels showing (1) requests per second to that service, (2) average, median, and p99 latency of requests to that service, and (3) p99 latency of requests to each instance of that service.\n</p>\n",
                  "datasource": null,
                  "description": "",
                  "id": 1,
                  "mode": "markdown",
                  "span": 12,
                  "title": "",
                  "transparent": true,
                  "type": "text"
               }
            ],
            "repeat": null,
            "repeatIteration": null,
            "repeatRowId": null,
            "showTitle": false,
            "title": "Remote ruler reads dashboard description",
            "titleSize": "h6"
         },
         {
            "collapse": false,
            "height": "100px",
            "panels": [
               {
                  "aliasColors": { },
                  "bars": false,
                  "dashLength": 10,
                  "dashes": false,
                  "datasource": "$datasource",
                  "description": "### Evaluations per second\nRate of rule expressions evaluated per second.\n\n",
                  "fill": 1,
                  "format": "reqps",
                  "id": 2,
                  "legend": {
                     "avg": false,
                     "current": false,
                     "max": false,
                     "min": false,
                     "show": true,
                     "total": false,
                     "values": false
                  },
                  "lines": true,
                  "linewidth": 1,
                  "links": [ ],
                  "nullPointMode": "null as zero",
                  "percentage": false,
                  "pointradius": 5,
                  "points": false,
                  "renderer": "flot",
                  "seriesOverrides": [ ],
                  "spaceLength": 10,
                  "span": 12,
                  "stack": false,
                  "steppedLine": false,
                  "targets": [
                     {
                        "expr": "(sum (rate(cortex_request_duration_seconds_count{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-frontend.*))\",route=~\"/httpgrpc.HTTP/Handle|.*api_v1_query\"}[$__rate_interval]))) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "instant": true,
                        "refId": "A_classic"
                     },
                     {
                        "expr": "(sum (histogram_count(rate(cortex_request_duration_seconds{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-frontend.*))\",route=~\"/httpgrpc.HTTP/Handle|.*api_v1_query\"}[$__rate_interval])))) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "instant": true,
                        "refId": "A"
                     }
                  ],
                  "thresholds": "70,80",
                  "timeFrom": null,
                  "timeShift": null,
                  "title": "Evaluations / sec",
                  "tooltip": {
                     "shared": false,
                     "sort": 0,
                     "value_type": "individual"
                  },
                  "type": "singlestat",
                  "xaxis": {
                     "buckets": null,
                     "mode": "time",
                     "name": null,
                     "show": true,
                     "values": [ ]
                  },
                  "yaxes": [
                     {
                        "format": "short",
                        "label": null,
                        "logBase": 1,
                        "max": null,
                        "min": 0,
                        "show": true
                     },
                     {
                        "format": "short",
                        "label": null,
                        "logBase": 1,
                        "max": null,
                        "min": null,
                        "show": false
                     }
                  ]
               }
            ],
            "repeat": null,
            "repeatIteration": null,
            "repeatRowId": null,
            "showTitle": false,
            "title": "Headlines",
            "titleSize": "h6"
         },
         {
            "collapse": false,
            "height": "250px",
            "panels": [
               {
                  "datasource": "$datasource",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 100,
                           "lineWidth": 0,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "normal"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "reqps"
                     },
                     "overrides": [
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "1xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EAB839",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "2xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "3xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#6ED0E0",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "4xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EF843C",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "5xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "OK"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "cancel"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "error"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "success"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "1xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EAB839",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "2xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "3xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#6ED0E0",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "4xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EF843C",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "5xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "Canceled"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "OK"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "Success"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "cancel"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "error"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        }
                     ]
                  },
                  "id": 3,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "(sum by (status) (\n  label_replace(label_replace(rate(cortex_request_duration_seconds_count{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-frontend.*))\", route=~\"/httpgrpc.HTTP/Handle|.*api_v1_query\"}[$__rate_interval]),\n  \"status\", \"${1}xx\", \"status_code\", \"([0-9])..\"),\n  \"status\", \"${1}\", \"status_code\", \"([a-zA-Z]+)\"))\n) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "{{status}}",
                        "refId": "A_classic"
                     },
                     {
                        "expr": "(sum by (status) (\n  label_replace(label_replace(histogram_count(rate(cortex_request_duration_seconds{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-frontend.*))\", route=~\"/httpgrpc.HTTP/Handle|.*api_v1_query\"}[$__rate_interval])),\n  \"status\", \"${1}xx\", \"status_code\", \"([0-9])..\"),\n  \"status\", \"${1}\", \"status_code\", \"([a-zA-Z]+)\"))\n) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "{{status}}",
                        "refId": "A"
                     }
                  ],
                  "title": "Requests / sec",
                  "type": "timeseries"
               },
               {
                  "datasource": "$datasource",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 1,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "ms"
                     },
                     "overrides": [ ]
                  },
                  "id": 4,
                  "links": [ ],
                  "nullPointMode": "null as zero",
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "(histogram_quantile(0.99, sum by (le) (cluster_job_route:cortex_request_duration_seconds_bucket:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-frontend.*))\", route=~\"/httpgrpc.HTTP/Handle|.*api_v1_query\"})) * 1e3) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "99th percentile",
                        "refId": "A_classic"
                     },
                     {
                        "expr": "(histogram_quantile(0.99, sum (cluster_job_route:cortex_request_duration_seconds:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-frontend.*))\", route=~\"/httpgrpc.HTTP/Handle|.*api_v1_query\"})) * 1e3) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "99th percentile",
                        "refId": "A_native"
                     },
                     {
                        "expr": "(histogram_quantile(0.50, sum by (le) (cluster_job_route:cortex_request_duration_seconds_bucket:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-frontend.*))\", route=~\"/httpgrpc.HTTP/Handle|.*api_v1_query\"})) * 1e3) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "50th percentile",
                        "refId": "B_classic"
                     },
                     {
                        "expr": "(histogram_quantile(0.50, sum (cluster_job_route:cortex_request_duration_seconds:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-frontend.*))\", route=~\"/httpgrpc.HTTP/Handle|.*api_v1_query\"})) * 1e3) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "50th percentile",
                        "refId": "B_native"
                     },
                     {
                        "expr": "(1e3 * sum(cluster_job_route:cortex_request_duration_seconds_sum:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-frontend.*))\", route=~\"/httpgrpc.HTTP/Handle|.*api_v1_query\"}) /\nsum(cluster_job_route:cortex_request_duration_seconds_count:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-frontend.*))\", route=~\"/httpgrpc.HTTP/Handle|.*api_v1_query\"})\n) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "Average",
                        "refId": "C_classic"
                     },
                     {
                        "expr": "(1e3 * sum(histogram_sum(cluster_job_route:cortex_request_duration_seconds:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-frontend.*))\", route=~\"/httpgrpc.HTTP/Handle|.*api_v1_query\"})) /\nsum(histogram_count(cluster_job_route:cortex_request_duration_seconds:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-frontend.*))\", route=~\"/httpgrpc.HTTP/Handle|.*api_v1_query\"}))\n) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "Average",
                        "refId": "C_native"
                     }
                  ],
                  "title": "Latency",
                  "type": "timeseries"
               },
               {
                  "datasource": "$datasource",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 0,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "s"
                     },
                     "overrides": [ ]
                  },
                  "id": 5,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "displayMode": "hidden",
                        "showLegend": false
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "exemplar": true,
                        "expr": "(histogram_quantile(0.99, sum by (le,pod) (rate(cortex_request_duration_seconds_bucket{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-frontend.*))\", route=~\"/httpgrpc.HTTP/Handle|.*api_v1_query\"}[$__rate_interval])))) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "",
                        "legendLink": null
                     },
                     {
                        "exemplar": true,
                        "expr": "(histogram_quantile(0.99, sum by (pod) (rate(cortex_request_duration_seconds{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-frontend.*))\", route=~\"/httpgrpc.HTTP/Handle|.*api_v1_query\"}[$__rate_interval])))) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "",
                        "legendLink": null
                     }
                  ],
                  "title": "Per pod p99 latency",
                  "type": "timeseries"
               }
            ],
            "repeat": null,
            "repeatIteration": null,
            "repeatRowId": null,
            "showTitle": true,
            "title": "Ruler-query-frontend",
            "titleSize": "h6"
         },
         {
            "collapse": false,
            "height": "250px",
            "panels": [
               {
                  "datasource": "$datasource",
                  "description": "### Requests / sec\n<p>\n  The query-scheduler is an optional service that moves the internal queue from the query-frontend into a separate component.\n  If the query-scheduler is not deployed, these panels will show \"No data.\"\n</p>\n\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 100,
                           "lineWidth": 0,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "normal"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "reqps"
                     },
                     "overrides": [
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "1xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EAB839",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "2xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "3xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#6ED0E0",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "4xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EF843C",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "5xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "Canceled"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "OK"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "cancel"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "error"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "success"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        }
                     ]
                  },
                  "id": 6,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "sum by (status) (\n  label_replace(label_replace(rate(cortex_query_scheduler_queue_duration_seconds_count{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-scheduler.*))\"}[$__rate_interval]),\n  \"status\", \"${1}xx\", \"status_code\", \"([0-9])..\"),\n  \"status\", \"${1}\", \"status_code\", \"([a-zA-Z]+)\"))\n",
                        "format": "time_series",
                        "legendFormat": "{{status}}",
                        "refId": "A"
                     }
                  ],
                  "title": "Requests / sec",
                  "type": "timeseries"
               },
               {
                  "datasource": "$datasource",
                  "description": "### Latency (Time in Queue)\n<p>\n  The query-scheduler is an optional service that moves the internal queue from the query-frontend into a separate component.\n  If the query-scheduler is not deployed, these panels will show \"No data.\"\n</p>\n\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 1,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "ms"
                     },
                     "overrides": [ ]
                  },
                  "id": 7,
                  "links": [ ],
                  "nullPointMode": "null as zero",
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "histogram_quantile(0.99, sum(rate(cortex_query_scheduler_queue_duration_seconds_bucket{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-scheduler.*))\"}[$__rate_interval])) by (le)) * 1e3",
                        "format": "time_series",
                        "legendFormat": "99th Percentile",
                        "refId": "A"
                     },
                     {
                        "expr": "histogram_quantile(0.50, sum(rate(cortex_query_scheduler_queue_duration_seconds_bucket{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-scheduler.*))\"}[$__rate_interval])) by (le)) * 1e3",
                        "format": "time_series",
                        "legendFormat": "50th Percentile",
                        "refId": "B"
                     },
                     {
                        "expr": "sum(rate(cortex_query_scheduler_queue_duration_seconds_sum{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-scheduler.*))\"}[$__rate_interval])) * 1e3 / sum(rate(cortex_query_scheduler_queue_duration_seconds_count{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-scheduler.*))\"}[$__rate_interval]))",
                        "format": "time_series",
                        "legendFormat": "Average",
                        "refId": "C"
                     }
                  ],
                  "title": "Latency (Time in Queue)",
                  "type": "timeseries",
                  "yaxes": [
                     {
                        "format": "ms",
                        "label": null,
                        "logBase": 1,
                        "max": null,
                        "min": 0,
                        "show": true
                     },
                     {
                        "format": "short",
                        "label": null,
                        "logBase": 1,
                        "max": null,
                        "min": null,
                        "show": false
                     }
                  ]
               },
               {
                  "datasource": "$datasource",
                  "description": "### Queue length\n<p>\n  The query-scheduler is an optional service that moves the internal queue from the query-frontend into a separate component.\n  If the query-scheduler is not deployed, these panels will show \"No data.\"\n</p>\n\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 0,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "queries"
                     },
                     "overrides": [ ]
                  },
                  "id": 8,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "displayMode": "hidden",
                        "showLegend": false
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "exemplar": true,
                        "expr": "sum(min_over_time(cortex_query_scheduler_queue_length{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-scheduler.*))\"}[$__interval]))",
                        "format": "time_series",
                        "legendFormat": "Queue length",
                        "legendLink": null
                     }
                  ],
                  "title": "Queue length",
                  "type": "timeseries"
               }
            ],
            "repeat": null,
            "repeatIteration": null,
            "repeatRowId": null,
            "showTitle": true,
            "title": "Ruler-query-scheduler",
            "titleSize": "h6"
         },
         {
            "collapse": false,
            "height": "250px",
            "panels": [
               {
                  "datasource": "$datasource",
                  "description": "### 99th Percentile Latency by Expected Query Component\n<p>\n  The query-scheduler creates subqueues\n  broken out by which query components (ingester, store-gateway, or both)\n  the querier is expected to fetch data from to service the query.\n</p><p>\n  Queries which have not had an expected query component determined are labeled 'unknown'.\n</p><p>\n  If the query-scheduler is not deployed, these panels will show \"No data.\"\n</p>\n\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 1,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "noValue": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "ms"
                     },
                     "overrides": [ ]
                  },
                  "id": 9,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "label_replace(histogram_quantile(0.99, sum(rate(cortex_query_scheduler_queue_duration_seconds_bucket{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-scheduler.*))\"}[$__rate_interval])) by (le, additional_queue_dimensions)) * 1e3, \"additional_queue_dimensions\", \"unknown\", \"additional_queue_dimensions\", \"^$\")\n",
                        "format": "time_series",
                        "legendFormat": "99th Percentile: {{ additional_queue_dimensions }}",
                        "refId": "A"
                     }
                  ],
                  "title": "99th Percentile Latency by Expected Query Component",
                  "type": "timeseries"
               },
               {
                  "datasource": "$datasource",
                  "description": "### 50th Percentile Latency by Expected Query Component\n<p>\n  The query-scheduler creates subqueues\n  broken out by which query components (ingester, store-gateway, or both)\n  the querier is expected to fetch data from to service the query.\n</p><p>\n  Queries which have not had an expected query component determined are labeled 'unknown'.\n</p><p>\n  If the query-scheduler is not deployed, these panels will show \"No data.\"\n</p>\n\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 1,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "noValue": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "ms"
                     },
                     "overrides": [ ]
                  },
                  "id": 10,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "label_replace(histogram_quantile(0.50, sum(rate(cortex_query_scheduler_queue_duration_seconds_bucket{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-scheduler.*))\"}[$__rate_interval])) by (le, additional_queue_dimensions)) * 1e3, \"additional_queue_dimensions\", \"unknown\", \"additional_queue_dimensions\", \"^$\")\n",
                        "format": "time_series",
                        "legendFormat": "50th Percentile: {{ additional_queue_dimensions }}",
                        "refId": "A"
                     }
                  ],
                  "title": "50th Percentile Latency by Expected Query Component",
                  "type": "timeseries"
               },
               {
                  "datasource": "$datasource",
                  "description": "### Average Latency by Expected Query Component\n<p>\n  The query-scheduler creates subqueues\n  broken out by which query components (ingester, store-gateway, or both)\n  the querier is expected to fetch data from to service the query.\n</p><p>\n  Queries which have not had an expected query component determined are labeled 'unknown'.\n</p><p>\n  If the query-scheduler is not deployed, these panels will show \"No data.\"\n</p>\n\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 1,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "noValue": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "ms"
                     },
                     "overrides": [ ]
                  },
                  "id": 11,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "label_replace(sum(rate(cortex_query_scheduler_queue_duration_seconds_sum{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-scheduler.*))\"}[$__rate_interval])) by (additional_queue_dimensions) * 1e3 / sum(rate(cortex_query_scheduler_queue_duration_seconds_count{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-scheduler.*))\"}[$__rate_interval])) by (additional_queue_dimensions), \"additional_queue_dimensions\", \"unknown\", \"additional_queue_dimensions\", \"^$\")\n",
                        "format": "time_series",
                        "legendFormat": "Average: {{ additional_queue_dimensions }}",
                        "refId": "C"
                     }
                  ],
                  "title": "Average Latency by Expected Query Component",
                  "type": "timeseries"
               }
            ],
            "repeat": null,
            "repeatIteration": null,
            "repeatRowId": null,
            "showTitle": true,
            "title": "Ruler-query-scheduler Latency (Time in Queue) Breakout by Expected Query Component",
            "titleSize": "h6"
         },
         {
            "collapse": false,
            "height": "250px",
            "panels": [
               {
                  "datasource": "$datasource",
                  "description": "### 99th Percentile Inflight Requests by Query Component vs. Total Connected Queriers\n<p>\n  The query-scheduler tracks query requests inflight\n  between the scheduler and the connected queriers,\n  broken out by which query component (ingester, store-gateway)\n  the querier is expected to fetch data from to service the query.\n</p><p>\n  Queries which require data from both ingesters and store-gateways\n  are counted in each category, so the sum of the two categories\n  may exceed the true total number of queries inflight.\n</p><p>\n  If the query-scheduler is not deployed, these panels will show \"No data.\"\n</p>\n\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 1,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "short"
                     },
                     "overrides": [ ]
                  },
                  "id": 12,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 12,
                  "targets": [
                     {
                        "expr": "sum by(query_component) (cortex_query_scheduler_querier_inflight_requests{quantile=\"0.99\", cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-scheduler.*))\"})",
                        "format": "time_series",
                        "legendFormat": "99th Percentile Inflight Requests: {{query_component}}",
                        "legendLink": null
                     },
                     {
                        "expr": "sum(cortex_query_scheduler_connected_querier_clients{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-query-scheduler.*))\"})",
                        "format": "time_series",
                        "legendFormat": "Total Connected Queriers",
                        "legendLink": null
                     }
                  ],
                  "title": "99th Percentile Inflight Requests by Query Component vs. Total Connected Queriers",
                  "type": "timeseries"
               }
            ],
            "repeat": null,
            "repeatIteration": null,
            "repeatRowId": null,
            "showTitle": true,
            "title": "Ruler-query-scheduler <-> Querier Inflight Requests",
            "titleSize": "h6"
         },
         {
            "collapse": false,
            "height": "250px",
            "panels": [
               {
                  "datasource": "$datasource",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 100,
                           "lineWidth": 0,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "normal"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "reqps"
                     },
                     "overrides": [
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "1xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EAB839",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "2xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "3xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#6ED0E0",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "4xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EF843C",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "5xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "Canceled"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "OK"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "cancel"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "error"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "success"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        }
                     ]
                  },
                  "id": 13,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "sum by (status) (\n  label_replace(label_replace(rate(cortex_querier_request_duration_seconds_count{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", route=~\"(prometheus|api_prom)_api_v1_.+\"}[$__rate_interval]),\n  \"status\", \"${1}xx\", \"status_code\", \"([0-9])..\"),\n  \"status\", \"${1}\", \"status_code\", \"([a-zA-Z]+)\"))\n",
                        "format": "time_series",
                        "legendFormat": "{{status}}",
                        "refId": "A"
                     }
                  ],
                  "title": "Requests / sec",
                  "type": "timeseries"
               },
               {
                  "datasource": "$datasource",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 1,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "ms"
                     },
                     "overrides": [ ]
                  },
                  "id": 14,
                  "links": [ ],
                  "nullPointMode": "null as zero",
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "histogram_quantile(0.99, sum by (le) (cluster_job_route:cortex_querier_request_duration_seconds_bucket:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", route=~\"(prometheus|api_prom)_api_v1_.+\"})) * 1e3",
                        "format": "time_series",
                        "legendFormat": "99th percentile",
                        "refId": "A"
                     },
                     {
                        "expr": "histogram_quantile(0.50, sum by (le) (cluster_job_route:cortex_querier_request_duration_seconds_bucket:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", route=~\"(prometheus|api_prom)_api_v1_.+\"})) * 1e3",
                        "format": "time_series",
                        "legendFormat": "50th percentile",
                        "refId": "B"
                     },
                     {
                        "expr": "1e3 * sum(cluster_job_route:cortex_querier_request_duration_seconds_sum:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", route=~\"(prometheus|api_prom)_api_v1_.+\"}) / sum(cluster_job_route:cortex_querier_request_duration_seconds_count:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", route=~\"(prometheus|api_prom)_api_v1_.+\"})",
                        "format": "time_series",
                        "legendFormat": "Average",
                        "refId": "C"
                     }
                  ],
                  "title": "Latency",
                  "type": "timeseries"
               },
               {
                  "datasource": "$datasource",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 0,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "s"
                     },
                     "overrides": [ ]
                  },
                  "id": 15,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "displayMode": "hidden",
                        "showLegend": false
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "exemplar": true,
                        "expr": "histogram_quantile(0.99, sum by(le, pod) (rate(cortex_querier_request_duration_seconds_bucket{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", route=~\"(prometheus|api_prom)_api_v1_.+\"}[$__rate_interval])))",
                        "format": "time_series",
                        "legendFormat": "",
                        "legendLink": null
                     }
                  ],
                  "title": "Per pod p99 latency",
                  "type": "timeseries"
               }
            ],
            "repeat": null,
            "repeatIteration": null,
            "repeatRowId": null,
            "showTitle": true,
            "title": "Ruler-querier",
            "titleSize": "h6"
         },
         {
            "collapse": false,
            "height": "250px",
            "panels": [
               {
                  "datasource": "$datasource",
                  "description": "### Requests / sec\nThis panel shows ingester query requests from all sources: the main query path, and the remote ruler query path, if in use. The data shown is as reported by ingesters.\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 100,
                           "lineWidth": 0,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "normal"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "reqps"
                     },
                     "overrides": [
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "1xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EAB839",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "2xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "3xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#6ED0E0",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "4xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EF843C",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "5xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "OK"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "cancel"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "error"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "success"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "1xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EAB839",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "2xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "3xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#6ED0E0",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "4xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EF843C",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "5xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "Canceled"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "OK"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "Success"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "cancel"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "error"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        }
                     ]
                  },
                  "id": 16,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "(sum by (status) (\n  label_replace(label_replace(rate(cortex_request_duration_seconds_count{cluster=~\"$cluster\", job=~\"($namespace)/((ingester.*|cortex|mimir|mimir-write.*))\",route=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"}[$__rate_interval]),\n  \"status\", \"${1}xx\", \"status_code\", \"([0-9])..\"),\n  \"status\", \"${1}\", \"status_code\", \"([a-zA-Z]+)\"))\n) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "{{status}}",
                        "refId": "A_classic"
                     },
                     {
                        "expr": "(sum by (status) (\n  label_replace(label_replace(histogram_count(rate(cortex_request_duration_seconds{cluster=~\"$cluster\", job=~\"($namespace)/((ingester.*|cortex|mimir|mimir-write.*))\",route=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"}[$__rate_interval])),\n  \"status\", \"${1}xx\", \"status_code\", \"([0-9])..\"),\n  \"status\", \"${1}\", \"status_code\", \"([a-zA-Z]+)\"))\n) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "{{status}}",
                        "refId": "A"
                     }
                  ],
                  "title": "Requests / sec",
                  "type": "timeseries"
               },
               {
                  "datasource": "$datasource",
                  "description": "### Latency\nThis panel shows ingester query requests from all sources: the main query path, and the remote ruler query path, if in use. The data shown is as reported by ingesters.\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 1,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "ms"
                     },
                     "overrides": [ ]
                  },
                  "id": 17,
                  "links": [ ],
                  "nullPointMode": "null as zero",
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "(histogram_quantile(0.99, sum by (le) (cluster_job_route:cortex_request_duration_seconds_bucket:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ingester.*|cortex|mimir|mimir-write.*))\", route=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"})) * 1e3) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "99th percentile",
                        "refId": "A_classic"
                     },
                     {
                        "expr": "(histogram_quantile(0.99, sum (cluster_job_route:cortex_request_duration_seconds:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ingester.*|cortex|mimir|mimir-write.*))\", route=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"})) * 1e3) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "99th percentile",
                        "refId": "A_native"
                     },
                     {
                        "expr": "(histogram_quantile(0.50, sum by (le) (cluster_job_route:cortex_request_duration_seconds_bucket:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ingester.*|cortex|mimir|mimir-write.*))\", route=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"})) * 1e3) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "50th percentile",
                        "refId": "B_classic"
                     },
                     {
                        "expr": "(histogram_quantile(0.50, sum (cluster_job_route:cortex_request_duration_seconds:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ingester.*|cortex|mimir|mimir-write.*))\", route=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"})) * 1e3) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "50th percentile",
                        "refId": "B_native"
                     },
                     {
                        "expr": "(1e3 * sum(cluster_job_route:cortex_request_duration_seconds_sum:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ingester.*|cortex|mimir|mimir-write.*))\", route=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"}) /\nsum(cluster_job_route:cortex_request_duration_seconds_count:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ingester.*|cortex|mimir|mimir-write.*))\", route=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"})\n) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "Average",
                        "refId": "C_classic"
                     },
                     {
                        "expr": "(1e3 * sum(histogram_sum(cluster_job_route:cortex_request_duration_seconds:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ingester.*|cortex|mimir|mimir-write.*))\", route=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"})) /\nsum(histogram_count(cluster_job_route:cortex_request_duration_seconds:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((ingester.*|cortex|mimir|mimir-write.*))\", route=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"}))\n) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "Average",
                        "refId": "C_native"
                     }
                  ],
                  "title": "Latency",
                  "type": "timeseries"
               },
               {
                  "datasource": "$datasource",
                  "description": "### Per ingester pod p99 latency\nThis panel shows ingester query requests from all sources: the main query path, and the remote ruler query path, if in use. The data shown is as reported by ingesters.\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 0,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "s"
                     },
                     "overrides": [ ]
                  },
                  "id": 18,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "displayMode": "hidden",
                        "showLegend": false
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "exemplar": true,
                        "expr": "(histogram_quantile(0.99, sum by (le,pod) (rate(cortex_request_duration_seconds_bucket{cluster=~\"$cluster\", job=~\"($namespace)/((ingester.*|cortex|mimir|mimir-write.*))\", route=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"}[$__rate_interval])))) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "",
                        "legendLink": null
                     },
                     {
                        "exemplar": true,
                        "expr": "(histogram_quantile(0.99, sum by (pod) (rate(cortex_request_duration_seconds{cluster=~\"$cluster\", job=~\"($namespace)/((ingester.*|cortex|mimir|mimir-write.*))\", route=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"}[$__rate_interval])))) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "",
                        "legendLink": null
                     }
                  ],
                  "title": "Per ingester pod p99 latency",
                  "type": "timeseries"
               }
            ],
            "repeat": null,
            "repeatIteration": null,
            "repeatRowId": null,
            "showTitle": true,
            "title": "Ingester - query requests from all sources",
            "titleSize": "h6"
         },
         {
            "collapse": false,
            "height": "250px",
            "panels": [
               {
                  "datasource": "$datasource",
                  "description": "### Requests / sec\nThis panel shows ingester query requests from just the ruler query path. The data shown is as reported by ruler-queriers.\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 100,
                           "lineWidth": 0,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "normal"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "reqps"
                     },
                     "overrides": [
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "1xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EAB839",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "2xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "3xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#6ED0E0",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "4xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EF843C",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "5xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "OK"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "cancel"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "error"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "success"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "1xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EAB839",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "2xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "3xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#6ED0E0",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "4xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EF843C",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "5xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "Canceled"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "OK"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "Success"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "cancel"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "error"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        }
                     ]
                  },
                  "id": 19,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "(sum by (status) (\n  label_replace(label_replace(rate(cortex_ingester_client_request_duration_seconds_count{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", operation=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"}[$__rate_interval]),\n  \"status\", \"${1}xx\", \"status_code\", \"([0-9])..\"),\n  \"status\", \"${1}\", \"status_code\", \"([a-zA-Z]+)\"))\n) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "{{status}}",
                        "refId": "A_classic"
                     },
                     {
                        "expr": "(sum by (status) (\n  label_replace(label_replace(histogram_count(rate(cortex_ingester_client_request_duration_seconds{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", operation=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"}[$__rate_interval])),\n  \"status\", \"${1}xx\", \"status_code\", \"([0-9])..\"),\n  \"status\", \"${1}\", \"status_code\", \"([a-zA-Z]+)\"))\n) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "{{status}}",
                        "refId": "A"
                     }
                  ],
                  "title": "Requests / sec",
                  "type": "timeseries"
               },
               {
                  "datasource": "$datasource",
                  "description": "### Latency\nThis panel shows ingester query requests from just the ruler query path. The data shown is as reported by ruler-queriers.\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 1,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "ms"
                     },
                     "overrides": [ ]
                  },
                  "id": 20,
                  "links": [ ],
                  "nullPointMode": "null as zero",
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "histogram_quantile(0.99, sum(rate(cortex_ingester_client_request_duration_seconds_bucket{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", operation=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"}[$__rate_interval])) by (le)) * 1e3",
                        "format": "time_series",
                        "legendFormat": "99th Percentile",
                        "refId": "A"
                     },
                     {
                        "expr": "histogram_quantile(0.50, sum(rate(cortex_ingester_client_request_duration_seconds_bucket{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", operation=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"}[$__rate_interval])) by (le)) * 1e3",
                        "format": "time_series",
                        "legendFormat": "50th Percentile",
                        "refId": "B"
                     },
                     {
                        "expr": "sum(rate(cortex_ingester_client_request_duration_seconds_sum{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", operation=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"}[$__rate_interval])) * 1e3 / sum(rate(cortex_ingester_client_request_duration_seconds_count{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", operation=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"}[$__rate_interval]))",
                        "format": "time_series",
                        "legendFormat": "Average",
                        "refId": "C"
                     }
                  ],
                  "title": "Latency",
                  "type": "timeseries",
                  "yaxes": [
                     {
                        "format": "ms",
                        "label": null,
                        "logBase": 1,
                        "max": null,
                        "min": 0,
                        "show": true
                     },
                     {
                        "format": "short",
                        "label": null,
                        "logBase": 1,
                        "max": null,
                        "min": null,
                        "show": false
                     }
                  ]
               },
               {
                  "datasource": "$datasource",
                  "description": "### Per querier pod p99 latency\nThis panel shows ingester query requests from just the ruler query path. The data shown is as reported by ruler-queriers.\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 0,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "s"
                     },
                     "overrides": [ ]
                  },
                  "id": 21,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "displayMode": "hidden",
                        "showLegend": false
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "exemplar": true,
                        "expr": "(histogram_quantile(0.99, sum by (le,pod) (rate(cortex_ingester_client_request_duration_seconds_bucket{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", operation=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"}[$__rate_interval])))) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "",
                        "legendLink": null
                     },
                     {
                        "exemplar": true,
                        "expr": "(histogram_quantile(0.99, sum by (pod) (rate(cortex_ingester_client_request_duration_seconds{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", operation=~\"/cortex.Ingester/(QueryStream|QueryExemplars|LabelValues|LabelNames|UserStats|AllUserStats|MetricsForLabelMatchers|MetricsMetadata|LabelNamesAndValues|LabelValuesCardinality|ActiveSeries)\"}[$__rate_interval])))) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "",
                        "legendLink": null
                     }
                  ],
                  "title": "Per querier pod p99 latency",
                  "type": "timeseries"
               }
            ],
            "repeat": null,
            "repeatIteration": null,
            "repeatRowId": null,
            "showTitle": true,
            "title": "Ingester - query requests from this query path only",
            "titleSize": "h6"
         },
         {
            "collapse": false,
            "height": "250px",
            "panels": [
               {
                  "datasource": "$datasource",
                  "description": "### Requests / sec\nThis panel shows store-gateway query requests from all sources: the main query path, and the remote ruler query path, if in use. The data shown is as reported by store-gateways.\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 100,
                           "lineWidth": 0,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "normal"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "reqps"
                     },
                     "overrides": [
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "1xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EAB839",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "2xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "3xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#6ED0E0",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "4xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EF843C",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "5xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "OK"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "cancel"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "error"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "success"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "1xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EAB839",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "2xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "3xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#6ED0E0",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "4xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EF843C",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "5xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "Canceled"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "OK"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "Success"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "cancel"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "error"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        }
                     ]
                  },
                  "id": 22,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "(sum by (status) (\n  label_replace(label_replace(rate(cortex_request_duration_seconds_count{cluster=~\"$cluster\", job=~\"($namespace)/((store-gateway.*|cortex|mimir|mimir-backend.*))\",route=~\"/gatewaypb.StoreGateway/.*\"}[$__rate_interval]),\n  \"status\", \"${1}xx\", \"status_code\", \"([0-9])..\"),\n  \"status\", \"${1}\", \"status_code\", \"([a-zA-Z]+)\"))\n) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "{{status}}",
                        "refId": "A_classic"
                     },
                     {
                        "expr": "(sum by (status) (\n  label_replace(label_replace(histogram_count(rate(cortex_request_duration_seconds{cluster=~\"$cluster\", job=~\"($namespace)/((store-gateway.*|cortex|mimir|mimir-backend.*))\",route=~\"/gatewaypb.StoreGateway/.*\"}[$__rate_interval])),\n  \"status\", \"${1}xx\", \"status_code\", \"([0-9])..\"),\n  \"status\", \"${1}\", \"status_code\", \"([a-zA-Z]+)\"))\n) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "{{status}}",
                        "refId": "A"
                     }
                  ],
                  "title": "Requests / sec",
                  "type": "timeseries"
               },
               {
                  "datasource": "$datasource",
                  "description": "### Latency\nThis panel shows store-gateway query requests from all sources: the main query path, and the remote ruler query path, if in use. The data shown is as reported by store-gateways.\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 1,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "ms"
                     },
                     "overrides": [ ]
                  },
                  "id": 23,
                  "links": [ ],
                  "nullPointMode": "null as zero",
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "(histogram_quantile(0.99, sum by (le) (cluster_job_route:cortex_request_duration_seconds_bucket:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((store-gateway.*|cortex|mimir|mimir-backend.*))\", route=~\"/gatewaypb.StoreGateway/.*\"})) * 1e3) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "99th percentile",
                        "refId": "A_classic"
                     },
                     {
                        "expr": "(histogram_quantile(0.99, sum (cluster_job_route:cortex_request_duration_seconds:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((store-gateway.*|cortex|mimir|mimir-backend.*))\", route=~\"/gatewaypb.StoreGateway/.*\"})) * 1e3) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "99th percentile",
                        "refId": "A_native"
                     },
                     {
                        "expr": "(histogram_quantile(0.50, sum by (le) (cluster_job_route:cortex_request_duration_seconds_bucket:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((store-gateway.*|cortex|mimir|mimir-backend.*))\", route=~\"/gatewaypb.StoreGateway/.*\"})) * 1e3) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "50th percentile",
                        "refId": "B_classic"
                     },
                     {
                        "expr": "(histogram_quantile(0.50, sum (cluster_job_route:cortex_request_duration_seconds:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((store-gateway.*|cortex|mimir|mimir-backend.*))\", route=~\"/gatewaypb.StoreGateway/.*\"})) * 1e3) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "50th percentile",
                        "refId": "B_native"
                     },
                     {
                        "expr": "(1e3 * sum(cluster_job_route:cortex_request_duration_seconds_sum:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((store-gateway.*|cortex|mimir|mimir-backend.*))\", route=~\"/gatewaypb.StoreGateway/.*\"}) /\nsum(cluster_job_route:cortex_request_duration_seconds_count:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((store-gateway.*|cortex|mimir|mimir-backend.*))\", route=~\"/gatewaypb.StoreGateway/.*\"})\n) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "Average",
                        "refId": "C_classic"
                     },
                     {
                        "expr": "(1e3 * sum(histogram_sum(cluster_job_route:cortex_request_duration_seconds:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((store-gateway.*|cortex|mimir|mimir-backend.*))\", route=~\"/gatewaypb.StoreGateway/.*\"})) /\nsum(histogram_count(cluster_job_route:cortex_request_duration_seconds:sum_rate{cluster=~\"$cluster\", job=~\"($namespace)/((store-gateway.*|cortex|mimir|mimir-backend.*))\", route=~\"/gatewaypb.StoreGateway/.*\"}))\n) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "Average",
                        "refId": "C_native"
                     }
                  ],
                  "title": "Latency",
                  "type": "timeseries"
               },
               {
                  "datasource": "$datasource",
                  "description": "### Per store-gateway pod p99 latency\nThis panel shows store-gateway query requests from all sources: the main query path, and the remote ruler query path, if in use. The data shown is as reported by store-gateways.\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 0,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "s"
                     },
                     "overrides": [ ]
                  },
                  "id": 24,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "displayMode": "hidden",
                        "showLegend": false
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "exemplar": true,
                        "expr": "(histogram_quantile(0.99, sum by (le,pod) (rate(cortex_request_duration_seconds_bucket{cluster=~\"$cluster\", job=~\"($namespace)/((store-gateway.*|cortex|mimir|mimir-backend.*))\", route=~\"/gatewaypb.StoreGateway/.*\"}[$__rate_interval])))) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "",
                        "legendLink": null
                     },
                     {
                        "exemplar": true,
                        "expr": "(histogram_quantile(0.99, sum by (pod) (rate(cortex_request_duration_seconds{cluster=~\"$cluster\", job=~\"($namespace)/((store-gateway.*|cortex|mimir|mimir-backend.*))\", route=~\"/gatewaypb.StoreGateway/.*\"}[$__rate_interval])))) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "",
                        "legendLink": null
                     }
                  ],
                  "title": "Per store-gateway pod p99 latency",
                  "type": "timeseries"
               }
            ],
            "repeat": null,
            "repeatIteration": null,
            "repeatRowId": null,
            "showTitle": true,
            "title": "Store-gateway - query requests from all sources",
            "titleSize": "h6"
         },
         {
            "collapse": false,
            "height": "250px",
            "panels": [
               {
                  "datasource": "$datasource",
                  "description": "### Requests / sec\nThis panel shows store-gateway query requests from just the ruler query path. The data shown is as reported by ruler-queriers.\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 100,
                           "lineWidth": 0,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "normal"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "reqps"
                     },
                     "overrides": [
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "1xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EAB839",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "2xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "3xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#6ED0E0",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "4xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EF843C",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "5xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "OK"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "cancel"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "error"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "success"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "1xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EAB839",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "2xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "3xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#6ED0E0",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "4xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#EF843C",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "5xx"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "Canceled"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "OK"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "Success"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#7EB26D",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "cancel"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#A9A9A9",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byName",
                              "options": "error"
                           },
                           "properties": [
                              {
                                 "id": "color",
                                 "value": {
                                    "fixedColor": "#E24D42",
                                    "mode": "fixed"
                                 }
                              }
                           ]
                        }
                     ]
                  },
                  "id": 25,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "(sum by (status) (\n  label_replace(label_replace(rate(cortex_storegateway_client_request_duration_seconds_count{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", operation=~\"/gatewaypb.StoreGateway/.*\"}[$__rate_interval]),\n  \"status\", \"${1}xx\", \"status_code\", \"([0-9])..\"),\n  \"status\", \"${1}\", \"status_code\", \"([a-zA-Z]+)\"))\n) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "{{status}}",
                        "refId": "A_classic"
                     },
                     {
                        "expr": "(sum by (status) (\n  label_replace(label_replace(histogram_count(rate(cortex_storegateway_client_request_duration_seconds{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", operation=~\"/gatewaypb.StoreGateway/.*\"}[$__rate_interval])),\n  \"status\", \"${1}xx\", \"status_code\", \"([0-9])..\"),\n  \"status\", \"${1}\", \"status_code\", \"([a-zA-Z]+)\"))\n) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "{{status}}",
                        "refId": "A"
                     }
                  ],
                  "title": "Requests / sec",
                  "type": "timeseries"
               },
               {
                  "datasource": "$datasource",
                  "description": "### Latency\nThis panel shows store-gateway query requests from just the ruler query path. The data shown is as reported by ruler-queriers.\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 1,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "ms"
                     },
                     "overrides": [ ]
                  },
                  "id": 26,
                  "links": [ ],
                  "nullPointMode": "null as zero",
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "histogram_quantile(0.99, sum(rate(cortex_storegateway_client_request_duration_seconds_bucket{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", operation=~\"/gatewaypb.StoreGateway/.*\"}[$__rate_interval])) by (le)) * 1e3",
                        "format": "time_series",
                        "legendFormat": "99th Percentile",
                        "refId": "A"
                     },
                     {
                        "expr": "histogram_quantile(0.50, sum(rate(cortex_storegateway_client_request_duration_seconds_bucket{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", operation=~\"/gatewaypb.StoreGateway/.*\"}[$__rate_interval])) by (le)) * 1e3",
                        "format": "time_series",
                        "legendFormat": "50th Percentile",
                        "refId": "B"
                     },
                     {
                        "expr": "sum(rate(cortex_storegateway_client_request_duration_seconds_sum{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", operation=~\"/gatewaypb.StoreGateway/.*\"}[$__rate_interval])) * 1e3 / sum(rate(cortex_storegateway_client_request_duration_seconds_count{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", operation=~\"/gatewaypb.StoreGateway/.*\"}[$__rate_interval]))",
                        "format": "time_series",
                        "legendFormat": "Average",
                        "refId": "C"
                     }
                  ],
                  "title": "Latency",
                  "type": "timeseries",
                  "yaxes": [
                     {
                        "format": "ms",
                        "label": null,
                        "logBase": 1,
                        "max": null,
                        "min": 0,
                        "show": true
                     },
                     {
                        "format": "short",
                        "label": null,
                        "logBase": 1,
                        "max": null,
                        "min": null,
                        "show": false
                     }
                  ]
               },
               {
                  "datasource": "$datasource",
                  "description": "### Per querier pod p99 latency\nThis panel shows store-gateway query requests from just the ruler query path. The data shown is as reported by ruler-queriers.\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 0,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "s"
                     },
                     "overrides": [ ]
                  },
                  "id": 27,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "displayMode": "hidden",
                        "showLegend": false
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "desc"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "exemplar": true,
                        "expr": "(histogram_quantile(0.99, sum by (le,pod) (rate(cortex_storegateway_client_request_duration_seconds_bucket{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", operation=~\"/gatewaypb.StoreGateway/.*\"}[$__rate_interval])))) and on() (vector($latency_metrics) == 1)",
                        "format": "time_series",
                        "legendFormat": "",
                        "legendLink": null
                     },
                     {
                        "exemplar": true,
                        "expr": "(histogram_quantile(0.99, sum by (pod) (rate(cortex_storegateway_client_request_duration_seconds{cluster=~\"$cluster\", job=~\"($namespace)/((ruler-querier.*))\", operation=~\"/gatewaypb.StoreGateway/.*\"}[$__rate_interval])))) and on() (vector($latency_metrics) == -1)",
                        "format": "time_series",
                        "legendFormat": "",
                        "legendLink": null
                     }
                  ],
                  "title": "Per querier pod p99 latency",
                  "type": "timeseries"
               }
            ],
            "repeat": null,
            "repeatIteration": null,
            "repeatRowId": null,
            "showTitle": true,
            "title": "Store-gateway - query requests from this query path only",
            "titleSize": "h6"
         },
         {
            "collapse": false,
            "height": "250px",
            "panels": [
               {
                  "datasource": "$datasource",
                  "description": "### Replicas\nThe minimum, maximum, and current number of ruler-querier replicas.\n\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 1,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "short"
                     },
                     "overrides": [
                        {
                           "matcher": {
                              "id": "byRegexp",
                              "options": "/Max .+/"
                           },
                           "properties": [
                              {
                                 "id": "custom.fillOpacity",
                                 "value": 0
                              },
                              {
                                 "id": "custom.lineStyle",
                                 "value": {
                                    "fill": "dash"
                                 }
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byRegexp",
                              "options": "/Current .+/"
                           },
                           "properties": [
                              {
                                 "id": "custom.fillOpacity",
                                 "value": 0
                              }
                           ]
                        },
                        {
                           "matcher": {
                              "id": "byRegexp",
                              "options": "/Min .+/"
                           },
                           "properties": [
                              {
                                 "id": "custom.fillOpacity",
                                 "value": 0
                              },
                              {
                                 "id": "custom.lineStyle",
                                 "value": {
                                    "fill": "dash"
                                 }
                              }
                           ]
                        }
                     ]
                  },
                  "id": 28,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 6,
                  "targets": [
                     {
                        "expr": "max by (scaletargetref_name) (\n  kube_horizontalpodautoscaler_spec_max_replicas{cluster=~\"$cluster\", namespace=~\"$namespace\", horizontalpodautoscaler=~\"keda-hpa-(?:mimir-)?ruler-querier\"}\n  # Add the scaletargetref_name label for readability\n  * on (cluster, namespace, horizontalpodautoscaler) group_left (scaletargetref_name)\n    group by (cluster, namespace, horizontalpodautoscaler, scaletargetref_name) (kube_horizontalpodautoscaler_info{cluster=~\"$cluster\", namespace=~\"$namespace\", horizontalpodautoscaler=~\"keda-hpa-(?:mimir-)?ruler-querier\"})\n)\n",
                        "format": "time_series",
                        "legendFormat": "Max {{ scaletargetref_name }}",
                        "legendLink": null
                     },
                     {
                        "expr": "max by (scaletargetref_name) (\n  kube_horizontalpodautoscaler_status_current_replicas{cluster=~\"$cluster\", namespace=~\"$namespace\", horizontalpodautoscaler=~\"keda-hpa-(?:mimir-)?ruler-querier\"}\n  # Add the scaletargetref_name label for readability\n  * on (cluster, namespace, horizontalpodautoscaler) group_left (scaletargetref_name)\n    group by (cluster, namespace, horizontalpodautoscaler, scaletargetref_name) (kube_horizontalpodautoscaler_info{cluster=~\"$cluster\", namespace=~\"$namespace\", horizontalpodautoscaler=~\"keda-hpa-(?:mimir-)?ruler-querier\"})\n)\n",
                        "format": "time_series",
                        "legendFormat": "Current {{ scaletargetref_name }}",
                        "legendLink": null
                     },
                     {
                        "expr": "max by (scaletargetref_name) (\n  kube_horizontalpodautoscaler_spec_min_replicas{cluster=~\"$cluster\", namespace=~\"$namespace\", horizontalpodautoscaler=~\"keda-hpa-(?:mimir-)?ruler-querier\"}\n  # Add the scaletargetref_name label for readability\n  * on (cluster, namespace, horizontalpodautoscaler) group_left (scaletargetref_name)\n    group by (cluster, namespace, horizontalpodautoscaler, scaletargetref_name) (kube_horizontalpodautoscaler_info{cluster=~\"$cluster\", namespace=~\"$namespace\", horizontalpodautoscaler=~\"keda-hpa-(?:mimir-)?ruler-querier\"})\n)\n",
                        "format": "time_series",
                        "legendFormat": "Min {{ scaletargetref_name }}",
                        "legendLink": null
                     }
                  ],
                  "title": "Replicas",
                  "type": "timeseries"
               },
               {
                  "datasource": "$datasource",
                  "description": "### Autoscaler failures rate\nThe rate of failures in the KEDA custom metrics API server. Whenever an error occurs, the KEDA custom\nmetrics server is unable to query the scaling metric from Prometheus so the autoscaler wouldn't work properly.\n\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 1,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "short"
                     },
                     "overrides": [ ]
                  },
                  "id": 29,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 6,
                  "targets": [
                     {
                        "expr": "sum by(cluster, namespace, metric, scaledObject, scaler) (\n  label_replace(\n    rate(keda_scaler_errors[$__rate_interval]),\n    \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\"\n  )\n) +\non(cluster, namespace, metric, scaledObject) group_left\n  # Using `max by ()` so that series churn doesn't break the promQL join\n  max by (cluster, namespace, metric, scaledObject) (\n    label_replace(\n      label_replace(\n          kube_horizontalpodautoscaler_spec_target_metric{cluster=~\"$cluster\", namespace=~\"$namespace\", horizontalpodautoscaler=~\"keda-hpa-(?:mimir-)?ruler-querier\"} * 0,\n          \"scaledObject\", \"$1\", \"horizontalpodautoscaler\", \"keda-hpa-(?:mimir-)?(.*)\"\n      ),\n      \"metric\", \"$1\", \"metric_name\", \"(.+)\"\n    )\n  )\n",
                        "format": "time_series",
                        "legendFormat": "{{scaler}} failures",
                        "legendLink": null
                     }
                  ],
                  "title": "Autoscaler failures rate",
                  "type": "timeseries"
               }
            ],
            "repeat": null,
            "repeatIteration": null,
            "repeatRowId": null,
            "showTitle": true,
            "title": "Ruler-querier - autoscaling",
            "titleSize": "h6"
         },
         {
            "collapse": false,
            "height": "250px",
            "panels": [
               {
                  "datasource": "$datasource",
                  "description": "### Scaling metric (CPU): Desired replicas\nThis panel shows the scaling metric exposed by KEDA divided by the target/threshold used.\nIt should represent the desired number of replicas, ignoring the min/max constraints applied later.\n\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 1,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "short"
                     },
                     "overrides": [ ]
                  },
                  "id": 30,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "sum by (scaler) (\n  # Using `max by ()` so that series churn doesn't break the promQL join\n  max by (cluster, namespace, scaledObject, metric, scaler) (\n    label_replace(\n      keda_scaler_metrics_value{cluster=~\"$cluster\", exported_namespace=~\"$namespace\", scaler=~\".*cpu.*\"},\n      \"namespace\", \"$1\", \"exported_namespace\", \"(.*)\"\n    )\n  )\n  /\n  on(cluster, namespace, scaledObject, metric) group_left\n    # Using `max by ()` so that series churn doesn't break the promQL join\n    max by (cluster, namespace, scaledObject, metric) (\n      label_replace(\n        label_replace(\n          kube_horizontalpodautoscaler_spec_target_metric{cluster=~\"$cluster\", namespace=~\"$namespace\", horizontalpodautoscaler=~\"keda-hpa-(?:mimir-)?ruler-querier\"},\n          \"metric\", \"$1\", \"metric_name\", \"(.+)\"\n        ),\n        \"scaledObject\", \"$1\", \"horizontalpodautoscaler\", \"keda-hpa-(?:mimir-)?(.*)\"\n      )\n    )\n)\n",
                        "format": "time_series",
                        "legendFormat": "{{ scaler }}",
                        "legendLink": null
                     }
                  ],
                  "title": "Scaling metric (CPU): Desired replicas",
                  "type": "timeseries"
               },
               {
                  "datasource": "$datasource",
                  "description": "### Scaling metric (memory): Desired replicas\nThis panel shows the scaling metric exposed by KEDA divided by the target/threshold used.\nIt should represent the desired number of replicas, ignoring the min/max constraints applied later.\n\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 1,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "short"
                     },
                     "overrides": [ ]
                  },
                  "id": 31,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "sum by (scaler) (\n  # Using `max by ()` so that series churn doesn't break the promQL join\n  max by (cluster, namespace, scaledObject, metric, scaler) (\n    label_replace(\n      keda_scaler_metrics_value{cluster=~\"$cluster\", exported_namespace=~\"$namespace\", scaler=~\".*memory.*\"},\n      \"namespace\", \"$1\", \"exported_namespace\", \"(.*)\"\n    )\n  )\n  /\n  on(cluster, namespace, scaledObject, metric) group_left\n    # Using `max by ()` so that series churn doesn't break the promQL join\n    max by (cluster, namespace, scaledObject, metric) (\n      label_replace(\n        label_replace(\n          kube_horizontalpodautoscaler_spec_target_metric{cluster=~\"$cluster\", namespace=~\"$namespace\", horizontalpodautoscaler=~\"keda-hpa-(?:mimir-)?ruler-querier\"},\n          \"metric\", \"$1\", \"metric_name\", \"(.+)\"\n        ),\n        \"scaledObject\", \"$1\", \"horizontalpodautoscaler\", \"keda-hpa-(?:mimir-)?(.*)\"\n      )\n    )\n)\n",
                        "format": "time_series",
                        "legendFormat": "{{ scaler }}",
                        "legendLink": null
                     }
                  ],
                  "title": "Scaling metric (memory): Desired replicas",
                  "type": "timeseries"
               },
               {
                  "datasource": "$datasource",
                  "description": "### Scaling metric (in-flight queries): Desired replicas\nThis panel shows the scaling metric exposed by KEDA divided by the target/threshold used.\nIt should represent the desired number of replicas, ignoring the min/max constraints applied later.\n\n",
                  "fieldConfig": {
                     "defaults": {
                        "custom": {
                           "drawStyle": "line",
                           "fillOpacity": 1,
                           "lineWidth": 1,
                           "pointSize": 5,
                           "showPoints": "never",
                           "spanNulls": false,
                           "stacking": {
                              "group": "A",
                              "mode": "none"
                           }
                        },
                        "min": 0,
                        "thresholds": {
                           "mode": "absolute",
                           "steps": [ ]
                        },
                        "unit": "short"
                     },
                     "overrides": [ ]
                  },
                  "id": 32,
                  "links": [ ],
                  "options": {
                     "legend": {
                        "showLegend": true
                     },
                     "tooltip": {
                        "mode": "multi",
                        "sort": "none"
                     }
                  },
                  "span": 4,
                  "targets": [
                     {
                        "expr": "sum by (scaler) (\n  # Using `max by ()` so that series churn doesn't break the promQL join\n  max by (cluster, namespace, scaledObject, metric, scaler) (\n    label_replace(\n      keda_scaler_metrics_value{cluster=~\"$cluster\", exported_namespace=~\"$namespace\", scaler=~\".*queries.*\"},\n      \"namespace\", \"$1\", \"exported_namespace\", \"(.*)\"\n    )\n  )\n  /\n  on(cluster, namespace, scaledObject, metric) group_left\n    # Using `max by ()` so that series churn doesn't break the promQL join\n    max by (cluster, namespace, scaledObject, metric) (\n      label_replace(\n        label_replace(\n          kube_horizontalpodautoscaler_spec_target_metric{cluster=~\"$cluster\", namespace=~\"$namespace\", horizontalpodautoscaler=~\"keda-hpa-(?:mimir-)?ruler-querier\"},\n          \"metric\", \"$1\", \"metric_name\", \"(.+)\"\n        ),\n        \"scaledObject\", \"$1\", \"horizontalpodautoscaler\", \"keda-hpa-(?:mimir-)?(.*)\"\n      )\n    )\n)\n",
                        "format": "time_series",
                        "legendFormat": "{{ scaler }}",
                        "legendLink": null
                     }
                  ],
                  "title": "Scaling metric (in-flight queries): Desired replicas",
                  "type": "timeseries"
               }
            ],
            "repeat": null,
            "repeatIteration": null,
            "repeatRowId": null,
            "showTitle": true,
            "title": "",
            "titleSize": "h6"
         }
      ],
      "schemaVersion": 14,
      "style": "dark",
      "tags": [
         "mimir"
      ],
      "templating": {
         "list": [
            {
               "current": {
                  "text": "default",
                  "value": "default"
               },
               "hide": 0,
               "label": "Data source",
               "name": "datasource",
               "options": [ ],
               "query": "prometheus",
               "refresh": 1,
               "regex": "",
               "type": "datasource"
            },
            {
               "allValue": ".+",
               "current": {
                  "selected": true,
                  "text": "All",
                  "value": "$__all"
               },
               "datasource": "$datasource",
               "hide": 0,
               "includeAll": true,
               "label": "cluster",
               "multi": true,
               "name": "cluster",
               "options": [ ],
               "query": "label_values(cortex_build_info, cluster)",
               "refresh": 1,
               "regex": "",
               "sort": 1,
               "tagValuesQuery": "",
               "tags": [ ],
               "tagsQuery": "",
               "type": "query",
               "useTags": false
            },
            {
               "allValue": ".+",
               "current": {
                  "selected": true,
                  "text": "All",
                  "value": "$__all"
               },
               "datasource": "$datasource",
               "hide": 0,
               "includeAll": false,
               "label": "namespace",
               "multi": true,
               "name": "namespace",
               "options": [ ],
               "query": "label_values(cortex_build_info{cluster=~\"$cluster\"}, namespace)",
               "refresh": 1,
               "regex": "",
               "sort": 1,
               "tagValuesQuery": "",
               "tags": [ ],
               "tagsQuery": "",
               "type": "query",
               "useTags": false
            },
            {
               "current": {
                  "selected": true,
                  "text": "classic",
                  "value": "1"
               },
               "description": "Choose between showing latencies based on low precision classic or high precision native histogram metrics.",
               "hide": 0,
               "includeAll": false,
               "label": "Latency metrics",
               "multi": false,
               "name": "latency_metrics",
               "options": [
                  {
                     "selected": false,
                     "text": "native",
                     "value": "-1"
                  },
                  {
                     "selected": true,
                     "text": "classic",
                     "value": "1"
                  }
               ],
               "query": "native : -1,classic : 1",
               "skipUrlSync": false,
               "type": "custom",
               "useTags": false
            }
         ]
      },
      "time": {
         "from": "now-1h",
         "to": "now"
      },
      "timepicker": {
         "refresh_intervals": [
            "5s",
            "10s",
            "30s",
            "1m",
            "5m",
            "15m",
            "30m",
            "1h",
            "2h",
            "1d"
         ],
         "time_options": [
            "5m",
            "15m",
            "1h",
            "6h",
            "12h",
            "24h",
            "2d",
            "7d",
            "30d"
         ]
      },
      "timezone": "utc",
      "title": "Mimir / Remote ruler reads",
      "uid": "f103238f7f5ab2f1345ce650cbfbfe2f",
      "version": 0
   }